<script>
	$(document).ready(function(){
		<% if (setting!=undefined) { %>
			let setting=<%- JSON.stringify(setting) %>;
			console.log(setting.invoice_note);
			$("#defaultInvoiceNote").val(setting.invoice_note);
			/*let companyLogoImg=window.atob(setting.company_logo);*/
			/*$("#companyLogoImg").attr('src',setting.company_logo);*/
			/*$("#companyLogoImg").attr('src',`data:image/png;base64,${setting.company_logo}`);*/


		<% } %>
	})
	function renderImage(){
		window.location.href='/getCompanyLogo';
	}

	function saveInvoiceSetting(){
		showLoader('#globalLoader');
		let defaultInvoiceNote=$("#defaultInvoiceNote").val();
		/*let companyLogo = $('#companyLogoImg').attr('src');*/
		/*var formdata = new FormData()
	    formdata.append('photo',$('#input-image').files[0])
		let file=$("#uploadedImageFile").val();*/
		/*let hexString = window.btoa(companyLogo);
		console.log(hexString);*/
		if(defaultInvoiceNote.length>5000){
			hideLoader('#globalLoader');
			showGlobalToast('#globalToast', 'error', 'Invoice note cannot be more than 5000 characters', 4000);
			return false;
		}
		console.log(defaultInvoiceNote);
		$.ajax({
		      type: 'POST',
		      url : '/editCompanySettingInvoice',
		      contentType: 'application/json',
		      dataType: 'json',
		      data:JSON.stringify({"defaultInvoiceNote":defaultInvoiceNote}),
		       success : function(response){
				   if(response.success){
						/*hideLoader('#globalLoader');*/
						$('[save-btn]').attr('disabled',true);
						setTimeout(function(){
							hideLoader('#globalLoader');
							showGlobalToast('#globalToast', 'success', response.message, 4000);
						},2000);
					   	/*location.reload(); */
				   }
		        },
		       error: function(response){
	                console.log('error is : '+JSON.stringify(response));
	                hideLoader('#globalLoader');
	                showGlobalToast('#globalToast', 'error', response.responseJSON.message, 4000);
		        }
		    });

	}
	function uploadCompanyLogo(input){
		var url = input.value;
	    var ext = url.substring(url.lastIndexOf('.') + 1).toLowerCase();
	    if (input.files && input.files[0]&& (ext == "gif" || ext == "png" || ext == "jpeg" || ext == "jpg")) {
	        var reader = new FileReader();
	        reader.onload = function (e) {
	        	console.log(e.target.result);
	        	$('#companyLogoImg').attr('src', e.target.result);
						$("[img-upload]").removeAttr('disabled');
	        }
	        reader.readAsDataURL(input.files[0]);
	    }
	}
</script>
